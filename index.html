<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Salesforce Lightning Out 2.0</title>
    <script 
        type="text/javascript" 
        async="" 
        src="https://da1767753962898.my.salesforce.com/lightning/lightning.out.latest/index.iife.prod.js">
    </script>
</head>
<body>
    <h1>Salesforce LWC 연동 (2.0 방식)</h1>

    
    <div id="container">
        <button id="login-button" onclick="login()" style="display:none;">Salesforce 로그인</button>
        
        <lightning-out-application id="lo-app" app-id="1UsHu000000sgYSKAY" components="c-test-lightning"></lightning-out-application>
        
    </div>

    <script>
        const CLIENT_ID = '3MVG9VTfpJmxg1yjLWfz5Za8o4IE9zddnTJHwQZNFsRmWzqtir_d48DdzPsIsjLcQF6vYFERqVQUeXW2713w_';
        const SF_DOMAIN = 'https://da1767753962898.my.salesforce.com';
        const REDIRECT_URI = 'https://jeon-heejae.github.io/test-website/callback.html';

        const token = localStorage.getItem('sf_token');

        if (!token) {
            document.getElementById('login-button').style.display = 'block';
        } else {
            initLightningOut();
        }

        function login() {
            const authUrl = `${SF_DOMAIN}/services/oauth2/authorize?response_type=token&client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}`;
            window.location.href = authUrl;
        }

        function initLightningOut() {
            // 5. Frontdoor URL 생성 (세션 수립용)
            // 2.0에서는 단순히 토큰만 주는 게 아니라 frontdoor.jsp 경로를 완성해서 주어야 합니다.
            const frontdoorUrl = `${SF_DOMAIN}/secur/frontdoor.jsp?sid=${token}`;
            
            const loApp = document.getElementById('lo-app');
            const lwcWrapper = document.getElementById('lwc-wrapper');

            // 속성 설정
            loApp.setAttribute('frontdoor-url', frontdoorUrl);

            // 이벤트 리스너: 앱 준비 완료 시 LWC 표시
            loApp.addEventListener('lo.application.ready', () => {
                console.log("Lightning Out Application Ready!");
            });

            loApp.addEventListener('lo.application.error', (e) => {
                console.error("App Error:", e.detail.message);
            });

            // 컴포넌트 로드 완료 확인용
            loApp.addEventListener('lo.component.ready', () => {
                console.log("Component is now ready and rendered!");
            });
        }
    </script>
</body>
</html>
