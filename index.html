<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce LWC in GitHub Pages</title>
    <style>
        #lightning-container { min-height: 500px; border: 1px solid #ccc; padding: 10px; }
        .login-btn { padding: 10px 20px; background: #0070d2; color: white; border: none; cursor: pointer; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Salesforce 연동 화면</h1>
    
    <div id="lightning-container">
        <p id="status-message">인증 확인 중...</p>
        <button id="login-button" class="login-btn" style="display:none;" onclick="login()">Salesforce 로그인</button>
    </div>

    <script src="https://da1767753962898.my.salesforce.com/lightning/lightning.out.js"></script>
    <script>
        // --- [설정 값 입력] ---
        const CLIENT_ID = '3MVG9VTfpJmxg1yjLWfz5Za8o4IE9zddnTJHwQZNFsRmWzqtir_d48DdzPsIsjLcQF6vYFERqVQUeXW2713w_'; // External Client App의 Consumer Key
        const SF_DOMAIN = 'https://da1767753962898.my.salesforce.com'; // Salesforce 내 도메인
        const REDIRECT_URI = 'https://jeon-heejae.github.io/test-website/callback.html'; // 등록한 Callback URL
        // ---------------------

        const token = localStorage.getItem('sf_token');
        const instanceUrl = localStorage.getItem('sf_instance');

        if (!token) {
            // 토큰이 없으면 로그인 버튼 표시
            document.getElementById('status-message').innerText = 'Salesforce 로그인이 필요합니다.';
            document.getElementById('login-button').style.display = 'block';
        } else {
            renderLWC();
        }

        function login() {
            const authUrl = `${SF_DOMAIN}/services/oauth2/authorize?response_type=token&client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}`;
            window.location.href = authUrl;
        }

        function renderLWC() {
            document.getElementById('status-message').innerText = 'Lightning Out 로딩 중...';

            // 1. Salesforce의 Lightning Out 라이브러리를 동적으로 로드합니다.
            const script = document.createElement('script');
            script.src = `${instanceUrl}/lightning/lightning.out.js`;
            script.onload = () => {
                console.log("라이브러리 로드 완료"); // 이 로그가 찍히는지 확인
                // 2. Lightning Out 초기화
                $Lightning.use("test_app", function() {
                    // 3. 컴포넌트 생성
                    console.log("Lightning Out 초기화 중..."); // 이 로그가 찍히는지 확인
                    $Lightning.createComponent(
                        "c-account-used-service-summary", // LWC 이름
                        { recordId: "001Hu00003xZax0IAC" }, // LWC에 전달할 파라미터 (선택)
                        "lightning-container", // 렌더링할 DOM ID
                        function(cmp) {
                            document.getElementById('status-message').style.display = 'none';
                            console.log("LWC 컴포넌트 렌더링 완료");
                        }
                    );
                }, instanceUrl, token);
            };
            document.head.appendChild(script);
        }
    </script>
</body>
</html>
